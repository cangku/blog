---
title: 输入URL到看到网页这个过程发生了什么？
date: 2019-02-11 18:00:00
tags:
    - 非学前端

categories:
    - 学习
---

浏览器地址栏输入 `https://blog.unofficial.cn` ，经过短暂等待后看到内容展示出来，这个短暂等待过程发生了什么事情？

找路
===

## URI 与 URL ？  
> [URI](https://zh.wikipedia.org/wiki/%E7%BB%9F%E4%B8%80%E8%B5%84%E6%BA%90%E6%A0%87%E5%BF%97%E7%AC%A6 "统一资源标识符 / Uniform Resource Identifier") 可以是资源的 URL ，也可以是资源的 URN。  
[URL](https://zh.wikipedia.org/wiki/%E7%BB%9F%E4%B8%80%E8%B5%84%E6%BA%90%E5%AE%9A%E4%BD%8D%E7%AC%A6 "统一资源定位符 / Uniform Resource Locator") 是资源的网络地址。

![Definition](//upload.wikimedia.org/wikipedia/commons/9/96/URI_syntax_diagram.png)

```
# Definition
URI = scheme:[//authority]path[?query][#fragment]
authority = [userinfo@]host[:port]

# Example
URI = https://blog.unofficial.cn?query1=hello&query2=world#main

scheme      : https
host        : blog.unofficial.cn
path (URI)  : /
query       : { query1: hello, query2: world }
fragment    : main
```

## DNS 解析 URL 获得 IP
> [DNS](https://zh.wikipedia.org/wiki/%E5%9F%9F%E5%90%8D%E7%B3%BB%E7%BB%9F "域名系统 / Domain Name System") 是将域名和 IP 地址相互映射的一个分布式数据库。
[Chromiun](https://github.com/chromium/chromium/blob/master/net/dns/host_resolver_impl.cc) 在接收到用户输入的 URL 之后开始调用网络模块下的 DNS 服务来解析 URL 。这一步主要是根据 URL 查找到域名对应的 IP 地址。  
* DNS CACHE（Chrome 有一个 DNS Client），如果缓存不对，可以通过 `chrome://net-internals/#dns` Clear Host Cache
* Hosts
* Local DNS 可以是 [ISP](https://zh.wikipedia.org/wiki/%E4%BA%92%E8%81%94%E7%BD%91%E6%9C%8D%E5%8A%A1%E4%BE%9B%E5%BA%94%E5%95%86 "互联网服务提供商 / Internet Service Provider") 分配的，也可以是自己设定的公共 DNS（eg. 阿里DNS：223.5.5.5和223.6.6.6，谷歌DNS：8.8.8.8，电信DNS：114.114.114.114）。
    * 浏览器发送 "query blog.unofficial.cn" 至 DNS 服务器，DNS 服务器首先检测自身缓存，如果存在则直接返回结果。
    * 如果记录过期（TTL）或者不存在，则：
        * DNS 服务器向根域名服务发送查询 "query blog.unofficial.cn" ，得到顶级域（.cn）的权威域名服务器地址。
        * DNS 服务器向 .cn 域的权威域名服务器发送查询 "query blog.unofficial.cn" ，得到主域（.unofficial.cn）的权威域名服务器地址。
        * DNS 服务器向 .unofficial.cn 域的权威域名服务器发送查询 "query blog.unofficial.cn" ，得到二级域名为 blog 的 A 记录，存入自身缓存并返回给客户端。

## 网络协议
> [OSI模型](https://zh.wikipedia.org/wiki/OSI%E6%A8%A1%E5%9E%8B "开放式系统互联通信模型 / Open System Interconnection model" ) 是一种网络概念模型，分为七层。

* 第七层 应用层 （WWW 服务器；FTP 服务器 etc.）
* 第六层 表达层 （把数据转换为能与接收者的系统格式兼容并适合传输的格式）
* 第五层 会话层 （在数据传输中设置和维护计算机网络中两台计算机之间的通信连接）
* 第四层 传输层 （传输表头添加到数据中形成数据包 TCP / UDP）
* 第三层 网络层 （网络表头添加到数据中形成数据包 IP）
* 第二层 链路层 （逻辑链路控制子层：；介质访问控制子层：；）
* 第一层 物理层 （网卡 etc.）

![](https://img-blog.csdn.net/20180115133703203?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY2MxOTQ5/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast)

## 什么是七层/四层/五层？
![](https://img-blog.csdn.net/20180115133954601?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY2MxOTQ5/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast)

## HTTP是如何工作的？
[HTTP](https://zh.wikipedia.org/wiki/%E8%B6%85%E6%96%87%E6%9C%AC%E4%BC%A0%E8%BE%93%E5%8D%8F%E8%AE%AE "超文本传输协议 / HyperText Transfer Protocol") 是万维网的数据通信的基础。[`更多HTTP相关知识`](/2019/02/14/非学前端-附录http/)。  
* 客户端发起请求，与服务端完成“TCP三次握手”
* 客户端向服务端发出“HTTP请求报文”
* 服务端在完成内部处理后，向客户端发出“HTTP响应报文”
* 客户端与服务端完成“TCP四次握手”

![](https://img-blog.csdn.net/20180115134155605?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY2MxOTQ5/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast)


## 发送请求
Chrome 经过上面的准备工作，通过 DNS 拿到了 IP ，然后调用系统库函数 socket，请求一个 TCP 流套接字。
https://www.cnblogs.com/zhuoqingsen/p/9456787.html

https://zhuanlan.zhihu.com/p/28262282