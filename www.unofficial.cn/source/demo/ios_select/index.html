layout: false
---
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <title>Document</title>
    <style>
        body {
            margin: 0;
        }
        ul {
            margin: 0;
            padding: 0;
            list-style-type: none;
        }

        /* select */
        .select-checked-value, .select-checked-text {
            position: absolute;
        }

        .select {
            position: relative;
            display: block;
            border: 1px solid #eee;
            width: 80px;
            height: 26px;
            line-height: 26px;
            -webkit-user-select: none;
        }
        .select:after {
            position: absolute;
            top: 50%;
            right: 1%;
            margin: -8px 8px 0 0;
            display: block;
            content: ' ';
            width: 10px;
            height: 10px;
            border-top: 1px solid #333;
            border-left: 1px solid #333;
            transform: rotate(-135deg);
        }
        .button {
            display: block;
            padding: 5px 10px;
            background-color: #fff;
            border: 1px solid #ccc;
            font-size: 12px;
            cursor: pointer;
        }
        .button-blue {
        	border: 1px solid #007aff;
            background-color: #007aff;
            color: #fff;
        }
        .select-checked {
            background-color: #eee;
        }
        .select-checked-text {
            width: 100%;
            padding-left: 5px;
        }
        .select-option {
            position: fixed;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #eee;
            border-top: solid 1px #ccc;
        }
        .select-option {
            position: fixed;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #eee;
            border-top: solid 1px #ccc;
        }

        .select-option-header {
            display: flex;
            justify-content: space-between;
            padding: 6px;
        }
        .select-option-body {
            background-color: #ddd;
            line-height: 30px;
            cursor: context-menu;
        }
        .select-option-body li {
            padding: 6px;
        }
        .select-option-body li.checking {
            background: #ccc;
        }
    </style>
</head>
<body>
    <select name="x">
        <option value="1">第一项</option>
        <option value="2">第二项</option>
        <option value="3">第三项</option>
    </select>
    <!--<div class="select" id="x">
        </!--<div class="select-checked-value">1</div>--/>
        <span class="select-checked-text">第一项</span>
        <div class="select-option">
            <header class="select-option-header">
                <span class="button">取消</span>
                <span class="button button-blue">确定</span>
            </header>
            
            <ul class="select-option-body">
                <li class="option" data-value="1">第一项</li>
                <li class="option select-checked" data-value="2">第二项</li>
                <li class="option" data-value="3">第三项</li>
            </ul>
        </div>
    </div>-->
    
    <select name="y">
        <option value="1">第Y一项</option>
        <option value="2">第Y二项</option>
        <option value="3">第Y三项</option>
    </select>
    <script>
        !function() {                
            var Select = (function() {
                // 根据select的name值作为id值初始化自定义select
                function Select() {
                    // 自定义select的class名
                    this.selectClassName = 'select';
                    this.body;
                    // 初始化自定义select元素
                    this.init();
                }

                Select.prototype.init = function() {
                    // addEvent
                    [].slice.call().forEach(function(ele) {
                        ele.addEventListener('click', function(e) {
                            // target || srcElement
                            var currentTarget = e.currentTarget;
                            var target = e.target || e.srcElement;
                            // console.log('%O', currentTarget);
                            if(target.className === 'select-checked-text' && target.nextElementSibling.style.display === 'none') {
                                self.lastOptiomEle ? (self.lastOptiomEle.style.display = 'none') : '';
                                self.lastCheckOptionEle = target;
                                self.lastOptiomEle = target.nextElementSibling;
                                // 当前对象的兄弟元素显示
                                target.nextElementSibling.style.display = 'block';
                            } else if(target.tagName.toUpperCase() === 'LI') {
                                console.log(self.lastLiEle && self.lastLiEle.className.split(' ').indexOf('checking') !== -1);
                                (self.lastLiEle && self.lastLiEle.className.split(' ').indexOf('checking') !== -1) && (self.lastLiEle.className = 'option');
                                self.lastLiEle = target;
                                self.lastCheckText = target.innerText;
                                (target.className.split(' ').indexOf('checking') === -1) && (target.className += ' checking');
                            } else if(target.className.split(' ').indexOf('cancel') !== -1) {
                                self.lastCheckText = '';
                                currentTarget.children[1].style.display = 'none'; 
                            } else if(target.className.split(' ').indexOf('confirm') !== -1) {
                                self.lastCheckText && ((self.lastCheckOptionEle.innerText = self.lastCheckText) && (self.lastCheckText = ''));
                                currentTarget.children[1].style.display = 'none';
                            }
                        });
                    })
                    
                }

                // 根据name创建select
                Select.prototype.create = function() {
                    var selectEle = [].slice.call(arguments)[0];
                    
                    var name = selectEle.name;
                    var firstOptionValue = selectEle[0].value;
                    var firstOptionText = selectEle[0].text;
                    
                    var len = selectEle.length;
                    var optionsHtml = '';
                    for(var i = 0; i < len; i++) {
                        var isChecking = firstOptionText === selectEle[i].text ? ' checking' : '';
                        isChecking !== '' && (this.lastLiEle = this.initLastLiEle('<li class="option checking" data-value="'+selectEle[i].value+'">'+selectEle[i].text+'</li>'));
                        optionsHtml += '<li class="option'+ isChecking +'" data-value="'+selectEle[i].value+'">'+selectEle[i].text+'</li>';
                    }
                    
                    var div = document.createElement('div');
                    div.className = this.selectClassName;
                    div.id = name;
                    div.innerHTML = 
                        '<!--<div class="select-checked-value">'+firstOptionValue+'</div>-->'+
                        '<span class="select-checked-text">'+firstOptionText+'</span>'+
                        '<div class="select-option" style="display: none;">'+
                            '<header class="select-option-header">'+
                                '<span class="cancel button">取消</span>'+
                                '<span class="confirm button button-blue">确定</span>'+
                            '</header>'+
                            
                            '<ul class="select-option-body">'+
                                optionsHtml
                            '</ul>'+
                        '</div>'
                    ;
                    this.body.appendChild(div);
                } 

                Select.prototype.hidden = function() {
                    // select-option
                    this.display = 'none';
                }

                // 初始化选中值
                Select.prototype.initLastLiEle = function() {
                    var div = document.createElement('div');
                    div.innerHTML = [].slice.call(arguments)[0];
                    return div.childNodes[0];
                }

                return Select;

            })()


            var body = document.querySelector('body');
            var selects = document.querySelectorAll('select');

            var len = this.selects.length;

            for(var i = 0; i < len; i++) {

                var select = new Select();
                select.body = body;
                // 创建自定义select
                select.create(selects[i]);
                // 隐藏源select
                selects[i].style.display = 'none';
            }

        }()
    </script>
    <div class="masklayer"></div>
</body>
</html>